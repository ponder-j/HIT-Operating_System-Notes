# 📂 操作系统第11章：文件管理 (File Management) 复习指南

## 🌟 核心逻辑：从上到下看文件

操作系统里的文件管理其实就在解决两个大问题：

1. **用户怎么用？** (逻辑层面：我要存照片、写文档)
2. **硬盘怎么存？** (物理层面：一堆0和1怎么塞进磁盘块里)

## 第一部分：基本概念 (Overview)

*对应课件 Page 4-10*

### 1. 什么是文件 (File)？

- **定义**：就是一组有名字的数据集合。
- **特性**：
  - **长期存在 (Long-term existence)**：关机了还在。
  - **可共享 (Sharable)**：不同程序/用户都能访问。
  - **有结构 (Structure)**：不是乱码，是有组织的数据。

### 2. 什么是文件系统 (File System)？

- **定义**：操作系统中负责管理文件的那部分软件。
- **功能**：帮你创建、删除、读写文件，还要管理权限（谁能看，谁能改）。
- **目标**：让用户不用操心底层硬盘是怎么转的，直接用文件名就能操作数据。

## 第二部分：文件的组织与访问 (File Organization & Access)

对应课件 Page 18-19

这是重点！考试常考优缺点对比。

想象你有一堆书（记录 Records），你怎么摆放它们？

1. **堆 (The Pile)**
   - **怎么放**：随便扔，毫无顺序。
   - **优点**：存得快（直接扔进去）。
   - **缺点**：找得慢（要从头翻到尾）。
   - **适用**：不知名的数据收集，或者作为日志。
2. **顺序文件 (Sequential File)**
   - **怎么放**：按顺序排好（比如按字母表）。
   - **优点**：如果你要从头读到尾（批量处理），效率最高。
   - **缺点**：想找中间某一个，还得从头找或者二分查找；想插队（插入新记录）很难，要移动后面所有人。
3. **索引顺序文件 (Indexed Sequential File)**
   - **怎么放**：书还是按顺序排，但加了一个“目录”（索引）。
   - **优点**：结合了顺序访问和随机访问的优点。
   - **结构**：由索引（Index）+ 主文件（Main file）+ 溢出文件（Overflow file，放新插入暂时没地儿去的数据）组成。
4. **索引文件 (Indexed File)**
   - **怎么放**：数据随便放，但有一个强大的索引表，记录了每个数据在哪。
   - **优点**：想找谁直接查表，速度快。
   - **缺点**：索引表可能很大。
5. **哈希文件 (Direct/Hashed File)**
   - **怎么放**：用公式（Hash函数）算出一个地址，直接放那。
   - **优点**：由于是算出来的，不用查表，直接定位，速度最快！

## 第三部分：文件目录 (File Directory)

*对应课件 Page 20-22*

- **目录也是一种文件**：只不过它存的不是你的照片，而是“文件清单”。
- **目录里存什么**：文件名、文件类型、物理地址（在磁盘哪儿）、权限（Owner）、时间戳（创建/修改时间）。
- **树形结构 (Tree-Structured Directory)**：
  - 这是现代系统最常用的。
  - **根目录 (Master/Root)** -> **用户目录** -> **子目录** -> **文件**。
  - **路径名 (Pathname)**：从根目录一路走下来的路（例如 `/User_B/Draw/ABC`）。

## 第四部分：记录的成组 (Record Blocking) 🔥 难点预警

*对应课件 Page 24-27*

这里开始变得抽象了。

- **逻辑记录 (Record)**：用户眼里的单位（比如Excel里的一行）。
- **物理块 (Block)**：硬盘读写的最小单位（就像快递箱子）。

**问题**：硬盘读写一次（一个Block）通常很大，而你的一行数据（Record）可能很小。怎么装箱？

1. **定长成组 (Fixed Blocking)**
   - **做法**：每个箱子固定装N个记录。
   - **缺点**：如果记录长度不统一，会浪费空间；容易导致记录跨越两个箱子（虽然图示是定长的）。通常用于定长记录。
2. **变长跨越 (Variable Blocking: Spanned)**
   - **做法**：记录长度不固定。一个箱子装不下了，把剩下的半截装到下一个箱子去。
   - **优点**：不浪费空间（箱子塞得满满的）。
   - **缺点**：读一条记录可能需要读两个箱子（访问两次磁盘），慢。
3. **变长不跨越 (Variable Blocking: Unspanned)**
   - **做法**：记录长度不固定。如果当前箱子剩的空间不够装下一条记录，那就不装了，留空，直接开新箱子。
   - **优点**：读一条记录只需读一个箱子，快。
   - **缺点**：箱子尾部有浪费的空间 (Internal Fragmentation)。

## 第五部分：二级存储管理 (Secondary Storage Management) 🔥🔥 核心考点

*对应课件 Page 28-36*

**问题**：文件要在磁盘上占地盘，怎么给它分配地盘？

### 1. 预分配 vs 动态分配

- **预分配**：文件创建时说好要多大，一次性给够。 (缺点：给多了浪费，给少了不够)。
- **动态分配**：用多少给多少，不够再加。 (现代系统多用这个)。

### 2. 文件分配方式 (File Allocation Methods) —— 必考！

#### A. 连续分配 (Contiguous Allocation)

- **原理**：文件占磁盘上一连串的块。
- **优点**：读写最快（磁头不用乱跳）。
- **缺点**：会有**外部碎片**（磁盘上有很多小空隙，但塞不下大文件）；文件想变大很难（后面可能被别人占了）。
- **课件图示**：Page 31 (Compaction 可以解决碎片问题，但很慢)。

#### B. 链式分配 (Chained Allocation)

- **原理**：像寻宝游戏。文件头告诉你第一块在哪，第一块里写着“下一块在XX”，以此类推。
- **优点**：没有外部碎片（只要有空块就能用）；文件容易变大。
- **缺点**：读写慢（必须从头找，不能直接跳到中间）；如果中间链条断了，后面数据就丢了。
- **课件图示**：Page 33。

#### C. 索引分配 (Indexed Allocation)

- **原理**：给每个文件建一个**索引块 (Index Block)**，里面列出了这个文件所有数据块的地址表。
- **优点**：支持直接访问（想看第10块，查表就知道在哪）；没有外部碎片。
- **缺点**：索引块本身要占空间；如果文件很大，一个索引块存不下，需要多级索引。
- **课件图示**：Page 35-36。

## 第六部分：空闲空间管理 (Free Space Management)

*对应课件 Page 37*

**问题**：怎么知道磁盘上哪些块是空的？

1. **位示图 (Bit Tables)**：用一串0和1代表磁盘块。0表示空，1表示满。找空块就是找0。
2. **空闲块链 (Chained Free Portions)**：把所有空块连成一条链，用的时候从链头取。
3. **索引 (Indexing)**：用专门的块记录空闲块的地址。
4. **空闲块列表 (Free Block List)**：维护一个表记录空闲块号。

## 📝 考试复习总结 (Cheat Sheet)

| **概念**     | **关键词/比喻**      | **优缺点**                                   |
| ------------ | -------------------- | -------------------------------------------- |
| **顺序文件** | 磁带、按字母排的书   | 适合从头读到尾，不适合查找/插入              |
| **索引文件** | 查字典               | 查找快，索引占空间                           |
| **连续分配** | 电影院连座           | 速度最快，但有外部碎片，扩展难               |
| **链式分配** | 寻宝游戏 (Next指针)  | 容易分配，但不支持随机访问，不仅慢还容易断链 |
| **索引分配** | 目录表 (Index Block) | 支持随机访问，现代系统最爱用                 |
| **位示图**   | 0011001...           | 简单，容易找连续空闲空间                     |

### 💡 建议复习策略

1. **看图**：重点看课件中画格子的图（Page 25-27, 31-36），理解块（Block）是怎么连起来的。
2. **背术语**：
   - File Allocation Table (FAT)
   - Contiguous / Chained / Indexed Allocation
   - Preallocation vs Dynamic Allocation
3. **搞懂区别**：一定要能说出“连续分配”和“链式分配”各自的优缺点，这是简答题的热门考点。